<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Зали</title>
    <style>
.status-pending  { color: #d4a100; font-weight: bold; }  
.status-approved { color: #2e7d32; font-weight: bold; } 
.status-rejected { color: #c62828; font-weight: bold; }
.status-canceled { color: #ffa500; font-weight: bold; } 
</style>

</h:head>

<h:body>


<h:form id="hallForm">

    <p:growl id="msgs" showDetail="true" life="4000"/>
  
    <p:commandButton value="Изход"
                 action="#{loginBean.logout}"
                 process="@this"
                 immediate="true"
                 ajax="false"/>
   <p:commandButton value="Заявки"
                 icon="pi pi-inbox"
                 action="/adminReservations.xhtml?faces-redirect=true"
                 rendered="#{loginBean.admin}"
                 immediate="true"
                 process="@this"
                 ajax="false"
                 style="margin-left:10px"/>

<p:panel rendered="#{loginBean.user}"
         style="max-width:1000px;margin:10px auto;background:#f7f7f7">

    <h:outputText value="За въпроси и заявки: "
                  style="font-weight:bold"/>

    <h:outputLink value="mailto:#{loginBean.adminEmail}">
        <h:outputText value="#{loginBean.adminEmail}" />
    </h:outputLink>
</p:panel>
    <p:panel header="Списък със зали" style="max-width:1000px;margin:30px auto;">
      
        <p:toolbar style="margin-bottom:10px;">
            <p:toolbarGroup>
               <p:commandButton value="Добави зала" icon="pi pi-plus"
                 actionListener="#{hallBean.newHall}"
                 update=":hallForm:dlg"
                 oncomplete="PF('dlg').show()"
                 rendered="#{loginBean.admin}"
                 process="@this"/>
 <p:commandButton value="Заяви резервация"
                 icon="pi pi-calendar-plus"
                 action="/reservation.xhtml?faces-redirect=true"
                 rendered="#{loginBean.user}" />
            </p:toolbarGroup>
              
            <p:toolbarGroup align="right">
            <p:commandButton value="Обнови" icon="pi pi-refresh"
                 actionListener="#{hallBean.refresh}"
                 update="hallForm:table"
                 process="@this"
                 immediate="true"/>

             <p:commandButton value="Моите резервации"
                 icon="pi pi-history"
                 action="/myReservations.xhtml?faces-redirect=true"
                 rendered="#{loginBean.user}"
                 ajax="false"
                 style="margin-left:10px"/>  
            </p:toolbarGroup>
        </p:toolbar>
             
        <p:dataTable id="table"
                     value="#{hallBean.halls}"
                     var="h"
                     rowKey="#{h.id}"
                     selectionMode="single"
                     selection="#{hallBean.selected}"
                     paginator="true"
                     rows="10"
                     rowsPerPageTemplate="5,10,20"
                     emptyMessage="Няма зали."
                     filterEvent="keyup">

            <p:column headerText="Име" sortBy="#{h.name}" filterBy="#{h.name}">
                <h:outputText value="#{h.name}"/>
            </p:column>

            <p:column headerText="Локация" sortBy="#{h.location}" filterBy="#{h.location}">
                <h:outputText value="#{h.location}"/>
            </p:column>

            <p:column headerText="Капацитет" sortBy="#{h.capacity}" style="width:120px;text-align:center;">
                <h:outputText value="#{h.capacity == null ? '—' : h.capacity}"/>
            </p:column>

            <p:column headerText="Тип" sortBy="#{h.type}" filterBy="#{h.type}" style="width:160px;">
                <h:outputText value="#{h.type}"/>
            </p:column>

            <p:column headerText="Действия" rendered="#{loginBean.admin}" style="width:220px;text-align:center;">
              <p:commandButton value="Редакция"
                 icon="pi pi-pencil"
                 actionListener="#{hallBean.prepareEdit(h)}"
                 update="hallForm:dlg"
                 oncomplete="PF('dlg').show()" />


             <p:commandButton value="Изтрий" icon="pi pi-trash"
                 actionListener="#{hallBean.delete(h)}"
                 process="@this" immediate="true"
                 update=":hallForm:table :hallForm:msgs"
                 onclick="return confirm('Сигурен ли си?');"
                 styleClass="ui-button-danger"/>

            </p:column>
<p:column headerText="Резервация" rendered="#{loginBean.user}" style="width:260px;text-align:center">

    <h:outputText value="#{hallBean.userReservationInfo(h)}"
                  styleClass="#{
                      hallBean.userReservationStatus(h) eq 'PENDING'  ? 'status-pending'  :
                      hallBean.userReservationStatus(h) eq 'APPROVED' ? 'status-approved' :
                      hallBean.userReservationStatus(h) eq 'REJECTED' ? 'status-rejected' :
                       hallBean.userReservationStatus(h) eq 'CANCELED' ? 'status-canceled' :
                      ''
                  }"/>
</p:column>

        </p:dataTable>

    </p:panel>

    <!-- DIALOG: Add/Edit -->
    <p:dialog id="dlg"
              widgetVar="dlg"
              header="Зала"
              modal="true"
              closable="true"
              resizable="false"
              width="520"
              rendered="#{loginBean.admin}">

        <p:panelGrid columns="2"
                     layout="grid"
                     styleClass="ui-fluid"
                     columnClasses="label,value"
                     style="width:100%">

            <p:outputLabel value="Име:" for="name"/>
            <p:inputText id="name" value="#{hallBean.selected.name}" required="true"
                         requiredMessage="Въведи име на залата."/>

            <p:outputLabel value="Локация:" for="loc"/>
            <p:inputText id="loc" value="#{hallBean.selected.location}" required="true"
                         requiredMessage="Въведи локация."/>

            <p:outputLabel value="Капацитет:" for="cap"/>
            <!-- emptyValue="empty" позволява null -->
            <p:inputNumber id="cap"
                           value="#{hallBean.selected.capacity}"
                           decimalPlaces="0"
                           emptyValue="empty"/>

            <p:outputLabel value="Тип:" for="type"/>
            <p:inputText id="type" value="#{hallBean.selected.type}" required="true"
                         requiredMessage="Въведи тип (напр. CONFERENCE, DANCE...)."/>
        </p:panelGrid>

        <p:separator/>

        <p:commandButton value="Запази"
                         icon="pi pi-check"
                         actionListener="#{hallBean.save}"
                         process=":hallForm:dlg"
                         update=":hallForm:table :hallForm:msgs"
                         oncomplete="PF('dlg').hide()"
                         style="width:100%;"/>

    </p:dialog>

</h:form>

</h:body>
</html>
