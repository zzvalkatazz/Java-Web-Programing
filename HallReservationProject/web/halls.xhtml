    <!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml"
          xmlns:h="http://xmlns.jcp.org/jsf/html"
          xmlns:f="http://xmlns.jcp.org/jsf/core"
          xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Зали</title>
        <style>
    .status-pending  { color: #d4a100; font-weight: bold; }  
    .status-approved { color: #2e7d32; font-weight: bold; } 
    .status-rejected { color: #c62828; font-weight: bold; }
    .status-canceled { color: #ffa500; font-weight: bold; } 
    </style>
    <style>
        .header-navigation {
            background-color: #D3D3D3; 
            border: 1px solid #dee2e6;  
            border-radius: 4px;         
            padding: 10px;              
            margin-bottom: 20px;        
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
        } 
        .nav-button {
            margin-right: 8px !important;
        }
        .contact-panel {
            margin-bottom: 25px !important;
        }
    </style>
    </h:head>

    <h:body>


    <h:form id="hallForm">

        <p:growl id="msgs" showDetail="true" life="4000"/>

        <div class="header-navigation">
                <p:toolbar style="border:none; background:transparent;">
                    <p:toolbarGroup>

       <p:commandButton value="Заявки"
                     icon="pi pi-inbox"
                     action="/adminReservations.xhtml?faces-redirect=true"
                     rendered="#{loginBean.admin}"
                     immediate="true"
                     process="@this"
                     ajax="false"
                     styleClass="nav-button"/>
        <p:commandButton value="История на заявки"
                     icon="pi pi-list"
                     action="/adminReservationsHistory.xhtml?faces-redirect=true"
                     rendered="#{loginBean.admin}"
                     immediate="true"
                     process="@this"
                     ajax="false"
                     styleClass="nav-button"/>
        <p:commandButton value="Потребители"
                     icon="pi pi-users"
                     action="/adminUsers.xhtml?faces-redirect=true"
                     rendered="#{loginBean.admin}"
                     immediate="true"
                     process="@this"
                     ajax="false"
                     styleClass="nav-button"/>
        <p:commandButton value="Смяна на парола"
                     icon="pi pi-lock"
                     action="/changePassword.xhtml?faces-redirect=true"
                     rendered="#{loginBean.user}"
                     immediate="true"
                     process="@this"
                     ajax="false"
                     styleClass="nav-button"/>

       <p:commandButton value="Статистика на състояния"
                     icon="pi pi-chart-bar"
                     action="/adminStats.xhtml?faces-redirect=true"
                     ajax="false"
                     rendered="#{loginBean.admin}"
                     process="@this"
                    immediate="true"
                     styleClass="nav-button"/>
       <p:commandButton value="Резервации по дни"
                     icon="pi pi-chart-line"
                     action="/adminTimeline.xhtml?faces-redirect=true"
                     ajax="false"
                     process="@this"
                     immediate="true"
                     styleClass="nav-button"/>
        </p:toolbarGroup>
             <p:toolbarGroup align="right">       
             <p:commandButton value="Изход"
                     action="#{loginBean.logout}"
                     process="@this"
                     immediate="true"
                     ajax="false"
                     styleClass="logout-button"/>   
             </p:toolbarGroup>
       </p:toolbar>
      </div>  
        <div class="main-content">
        <p:panel rendered="#{loginBean.user}"
             style="margin-bottom:20px; border-left: 5px solid #2196F3;">
            
         <h:panelGroup rendered="#{loginBean.user}">
        <h:outputText value="Здравейте, #{loginBean.loggedUser.fullName}!" 
                      style="display: block; 
                             margin-bottom: 10px; 
                             font-size: 1.2em; 
                             color: #2c3e50; 
                             font-weight: 500;"/>
    </h:panelGroup>
        <h:outputText value="За въпроси и заявки: "
                      style="font-weight:bold"/>
        <h:outputLink value="mailto:#{loginBean.adminEmail}">
            <h:outputText value="#{loginBean.adminEmail}" />
        </h:outputLink>
    </p:panel>
        <p:panel header="Списък със зали" style="margin-bottom:30px;">

            <p:toolbar style="margin-bottom:15px; padding: 5px;">
                <p:toolbarGroup>
                   <p:commandButton value="Добави зала" icon="pi pi-plus"
                     actionListener="#{hallBean.newHall}"
                     update=":hallForm:dlg"
                     oncomplete="PF('dlg').show()"
                     rendered="#{loginBean.admin}"
                     process="@this"
                     styleClass="ui-button-success" style="margin-right:10px"/>
     <p:commandButton value="Заяви резервация"
                     icon="pi pi-calendar-plus"
                     action="/reservation.xhtml?faces-redirect=true"
                     rendered="#{loginBean.canReserve}" 
                     process="@this"
                     styleClass="ui-button-info"/>
     <p:commandButton value="Моите резервации"
                     icon="pi pi-history"
                     action="/myReservations.xhtml?faces-redirect=true"
                     rendered="#{loginBean.user}"
                     ajax="false"
                     process="@this"
                     style="margin-left:10px"/>  

                </p:toolbarGroup>

                <p:toolbarGroup align="right">
                <p:commandButton value="Обнови" icon="pi pi-refresh"
                     actionListener="#{hallBean.refresh}"
                     update="hallForm:table"
                     process="@this"
                     styleClass="ui-button-outlined ui-button-secondary"
                     immediate="true"/>


                </p:toolbarGroup>
            </p:toolbar>

            <p:dataTable id="table"
                         value="#{hallBean.halls}"
                         var="h"
                         rowKey="#{h.id}"
                         selectionMode="single"
                         selection="#{hallBean.selected}"
                         paginator="true"
                         rows="10"
                         rowsPerPageTemplate="5,10,20"
                         emptyMessage="Няма зали."
                         filterEvent="keyup">

                <p:column headerText="Име" sortBy="#{h.name}" filterBy="#{h.name}">
                    <h:outputText value="#{h.name}"/>
                </p:column>

                <p:column headerText="Локация" sortBy="#{h.location}" filterBy="#{h.location}">
                    <h:outputText value="#{h.location}"/>
                </p:column>

                <p:column headerText="Капацитет" sortBy="#{h.capacity}" style="width:120px;text-align:center;">
                    <h:outputText value="#{h.capacity == null ? '—' : h.capacity}"/>
                </p:column>

                <p:column headerText="Тип" sortBy="#{h.type}" filterBy="#{h.type}" style="width:160px;">
                    <h:outputText value="#{h.type}"/>
                </p:column>

                <p:column headerText="Действия" rendered="#{loginBean.admin}" style="width:180px;text-align:center;">
                  <p:commandButton value="Редакция"
                     icon="pi pi-pencil"
                     actionListener="#{hallBean.prepareEdit(h)}"
                     update="hallForm:dlg"
                     oncomplete="PF('dlg').show()" 
                     style="width: 140px; margin-bottom: 8px;"/>


                 <p:commandButton value="Изтрий" icon="pi pi-trash"
                     actionListener="#{hallBean.delete(h)}"
                     process="@this" immediate="true"
                     update=":hallForm:table :hallForm:msgs"
                     onclick="return confirm('Сигурен ли си?');"
                     style="width: 140px;"/>

                </p:column>
    <p:column headerText="Резервация" rendered="#{loginBean.user}" style="width:260px;text-align:center">

        <h:outputText value="#{hallBean.userReservationInfo(h)}"
                      styleClass="#{
                          hallBean.userReservationStatus(h) eq 'PENDING'  ? 'status-pending'  :
                          hallBean.userReservationStatus(h) eq 'APPROVED' ? 'status-approved' :
                          hallBean.userReservationStatus(h) eq 'REJECTED' ? 'status-rejected' :
                           hallBean.userReservationStatus(h) eq 'CANCELED' ? 'status-canceled' :
                          ''
                      }"/>
    </p:column>

            </p:dataTable>

        </p:panel>    


        </div>   


       
        <p:dialog id="dlg"
                  widgetVar="dlg"
                  header="Зала"
                  modal="true"
                  closable="true"
                  resizable="false"
                  width="520"
                  rendered="#{loginBean.admin}">

            <p:panelGrid columns="2"
                         layout="grid"
                         styleClass="ui-fluid"
                         columnClasses="label,value"
                         style="width:100%">


                <p:outputLabel value="Име:" for="name"/>
                <h:panelGroup>
                <p:inputText id="name" value="#{hallBean.selected.name}" required="true"
                             requiredMessage="Въведи име на залата."/> 
                </h:panelGroup>


                   <p:outputLabel value="Локация:" for="loc"/>
                  <h:panelGroup> 
                <p:inputText id="loc" value="#{hallBean.selected.location}" required="true"
                             requiredMessage="Въведи локация."/>  
                </h:panelGroup>


                <p:outputLabel value="Капацитет:" for="cap"/>
                 <h:panelGroup>
                <p:inputNumber id="cap"
                               value="#{hallBean.selected.capacity}"
                               decimalPlaces="0"
                               emptyValue="empty"/>
                </h:panelGroup>
                    <p:outputLabel value="Тип:" for="type"/>
                  <h:panelGroup>  
                <p:inputText id="type" value="#{hallBean.selected.type}" required="true"
                             requiredMessage="Въведи тип (напр. CONFERENCE, DANCE...)."/> 
                </h:panelGroup>

            </p:panelGrid>

            <p:separator/>
             <f:facet name="footer">
            <p:commandButton value="Запази"
                             icon="pi pi-check"
                             actionListener="#{hallBean.save}"
                             process=":hallForm:dlg"
                             update=":hallForm:table :hallForm:msgs"
                             oncomplete="PF('dlg').hide()"
                             style="width:100%;"/>
          </f:facet>
        </p:dialog>

    </h:form>

    </h:body>
    </html>
